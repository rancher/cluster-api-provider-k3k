---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  name: k3kcontrolplanes.controlplane.cluster.x-k8s.io
spec:
  group: controlplane.cluster.x-k8s.io
  names:
    kind: K3kControlPlane
    listKind: K3kControlPlaneList
    plural: k3kcontrolplanes
    singular: k3kcontrolplane
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: K3kControlPlane is the Schema for the K3kcontrolplanes API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: Spec is the desired spec of the K3k controlPlane.
            properties:
              addons:
                description: Addons is a list of secrets containing raw YAML which
                  will be deployed in the virtual K3k cluster on startup.
                items:
                  description: Addon specifies a Secret containing YAML to be deployed
                    on cluster startup.
                  properties:
                    secretNamespace:
                      description: SecretNamespace is the namespace of the Secret.
                      type: string
                    secretRef:
                      description: SecretRef is the name of the Secret.
                      type: string
                  type: object
                type: array
              agentArgs:
                description: AgentArgs are the ordered key value pairs (e.x. "testArg",
                  "testValue") for the K3s pods running in agent mode.
                items:
                  type: string
                type: array
              agents:
                description: Agents is the number of K3s pods to run in agent (worker)
                  mode.
                format: int32
                type: integer
              clusterCIDR:
                description: ClusterCIDR is the CIDR range for the pods of the cluster.
                  Defaults to 10.42.0.0/16.
                type: string
              clusterDNS:
                description: |-
                  ClusterDNS is the IP address for the coredns service. Needs to be in the range provided by ServiceCIDR or CoreDNS may not deploy.
                  Defaults to 10.43.0.10.
                type: string
              expose:
                description: |-
                  Expose contains options for exposing the apiserver inside/outside of the cluster. By default, this is only exposed as a
                  clusterIP which is relatively secure, but difficult to access outside of the cluster.
                properties:
                  ingress:
                    description: Ingress specifies options for exposing the API server
                      through an Ingress.
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: Annotations specifies annotations to add to the
                          Ingress.
                        type: object
                      ingressClassName:
                        description: IngressClassName specifies the IngressClass to
                          use for the Ingress.
                        type: string
                    type: object
                  loadbalancer:
                    description: LoadBalancer specifies options for exposing the API
                      server through a LoadBalancer service.
                    properties:
                      etcdPort:
                        description: |-
                          ETCDPort is the port on which the ETCD service is exposed when type is LoadBalancer.
                          If not specified, the default etcd 2379 port will be allocated.
                          If 0 or negative, the port will not be exposed.
                        format: int32
                        type: integer
                      serverPort:
                        description: |-
                          ServerPort is the port on which the K3s server is exposed when type is LoadBalancer.
                          If not specified, the default https 443 port will be allocated.
                          If 0 or negative, the port will not be exposed.
                        format: int32
                        type: integer
                    type: object
                  nodePort:
                    description: NodePort specifies options for exposing the API server
                      through NodePort.
                    properties:
                      etcdPort:
                        description: |-
                          ETCDPort is the port on each node on which the ETCD service is exposed when type is NodePort.
                          If not specified, a random port between 30000-32767 will be allocated.
                          If out of range, the port will not be exposed.
                        format: int32
                        type: integer
                      serverPort:
                        description: |-
                          ServerPort is the port on each node on which the K3s server is exposed when type is NodePort.
                          If not specified, a random port between 30000-32767 will be allocated.
                          If out of range, the port will not be exposed.
                        format: int32
                        type: integer
                    type: object
                type: object
              hostKubeconfig:
                description: |-
                  HostKubeconfig specifies the location of the Kubernetes secret containing the kubeconfig for the host cluster where the K3k cluster will be installed.
                  If not provided, the K3k cluster will be created in the current context's cluster.
                properties:
                  secretName:
                    description: SecretName is the name of the secret containing the
                      kubconfig data.
                    type: string
                  secretNamespace:
                    description: SecretNamespace is the namespace of the secret containing
                      the kubeconfig data.
                    type: string
                required:
                - secretName
                - secretNamespace
                type: object
              hostTargetNamespace:
                description: |-
                  HostTargetNamespace is the host namespace where the virtual cluster will be installed.
                  If not provided a namespace with the k3k-<cluster_name> prefix will be created.
                type: string
              persistence:
                description: |-
                  Persistence contains options controlling how the etcd data of the virtual cluster is persisted. By default, no data
                  persistence is guaranteed, so restart of a virtual cluster pod may result in data loss without this field.
                properties:
                  storageClassName:
                    description: |-
                      StorageClassName is the name of the StorageClass to use for the PVC.
                      This field is only relevant in "dynamic" mode.
                    type: string
                  storageRequestSize:
                    description: |-
                      StorageRequestSize is the requested size for the PVC.
                      This field is only relevant in "dynamic" mode.
                    type: string
                  type:
                    default: dynamic
                    description: Type specifies the persistence mode.
                    type: string
                required:
                - type
                type: object
              serverArgs:
                description: ServerArgs are the ordered key value pairs (e.x. "testArg",
                  "testValue") for the K3s pods running in server mode.
                items:
                  type: string
                type: array
              servers:
                description: Servers is the number of K3s pods to run in server (controlplane)
                  mode.
                format: int32
                type: integer
              serviceCIDR:
                description: ServiceCIDR is the CIDR range for the services in the
                  cluster. Defaults to 10.43.0.0/16.
                type: string
              tlsSANs:
                description: TLSSANs are the subjectAlternativeNames for the certificate
                  the K3s server will use.
                items:
                  type: string
                type: array
              token:
                description: Token is the token used to join the worker nodes to the
                  cluster.
                type: string
              version:
                description: Version is a string representing the Kubernetes version
                  to be used by the virtual nodes.
                type: string
            type: object
          status:
            description: Status is the current status of the K3k controlPlane.
            properties:
              clusterStatus:
                description: ClusterStatus is the status of the backing K3k cluster
                  type.
                properties:
                  clusterCIDR:
                    description: ClusterCIDR is the CIDR range for pod IPs.
                    type: string
                  clusterDNS:
                    description: ClusterDNS is the IP address for the CoreDNS service.
                    type: string
                  hostVersion:
                    description: HostVersion is the Kubernetes version of the host
                      node.
                    type: string
                  persistence:
                    description: Persistence specifies options for persisting etcd
                      data.
                    properties:
                      storageClassName:
                        description: |-
                          StorageClassName is the name of the StorageClass to use for the PVC.
                          This field is only relevant in "dynamic" mode.
                        type: string
                      storageRequestSize:
                        description: |-
                          StorageRequestSize is the requested size for the PVC.
                          This field is only relevant in "dynamic" mode.
                        type: string
                      type:
                        default: dynamic
                        description: Type specifies the persistence mode.
                        type: string
                    required:
                    - type
                    type: object
                  policyName:
                    description: PolicyName specifies the virtual cluster policy name
                      bound to the virtual cluster.
                    type: string
                  serviceCIDR:
                    description: ServiceCIDR is the CIDR range for service IPs.
                    type: string
                  tlsSANs:
                    description: TLSSANs specifies subject alternative names for the
                      K3s server certificate.
                    items:
                      type: string
                    type: array
                type: object
              externalManagedControlPlane:
                description: |-
                  ExternalManagedControlPlane conforms to the upstream CAPI interface - true if node objects do not exist in the controlplane.
                  While K3k does have specific pods for the controlplane, these don't correspond to specific CAPI objects/machines, so in the
                  current state this will always be true.
                type: boolean
              initialized:
                description: Initialized conforms to the upstream CAPI interface -
                  true when the controlplane is contactable.
                type: boolean
              ready:
                description: Ready conforms to the upstream CAPI interface - true
                  when the target API Server is ready to receive requests.
                type: boolean
            required:
            - clusterStatus
            - externalManagedControlPlane
            - initialized
            - ready
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
